
-- pgsqlds3_create_db.sql: DVD Store Database Version 3.0 Build Script - Postgres version
-- Copyright (C) 2011 Vmware, Inc. 
-- Last updated 3/31/21

CREATE UNIQUE INDEX IX_CUST_USERNAME ON CUSTOMERS 
  (
  USERNAME
  );

CREATE UNIQUE INDEX IX_CUST_USER_PASSWORD ON CUSTOMERS 
  (
  USERNAME,
  PASSWORD
  );

CREATE INDEX IX_CUST_HIST_CUSTOMERID ON CUST_HIST
  (
  CUSTOMERID
  );

ALTER TABLE CUST_HIST
  ADD CONSTRAINT FK_CUST_HIST_CUSTOMERID FOREIGN KEY (CUSTOMERID)
  REFERENCES CUSTOMERS (CUSTOMERID)
  ON DELETE CASCADE
  ;

CREATE INDEX IX_ORDER_CUSTID ON ORDERS
  (
  CUSTOMERID
  );

ALTER TABLE ORDERS 
  ADD CONSTRAINT FK_CUSTOMERID FOREIGN KEY (CUSTOMERID)
  REFERENCES CUSTOMERS (CUSTOMERID)
  ON DELETE SET NULL
  ;

CREATE UNIQUE INDEX IX_ORDERLINES_ORDERID ON ORDERLINES
  (
  ORDERID, ORDERLINEID
  );

ALTER TABLE ORDERLINES
  ADD CONSTRAINT FK_ORDERID FOREIGN KEY (ORDERID)
  REFERENCES ORDERS (ORDERID)
  ON DELETE CASCADE
  ;

CREATE INDEX IX_PROD_ACTOR ON PRODUCTS 
USING GIN
  (
  to_tsvector('simple',ACTOR)
  );

CREATE INDEX IX_PROD_CATEGORY ON PRODUCTS 
  (
  CATEGORY
  );

CREATE INDEX IX_PROD_TITLE ON PRODUCTS 
USING GIN
  (
   to_tsvector('simple',TITLE)
  );

CREATE INDEX IX_PROD_SPECIAL ON PRODUCTS 
  (
  SPECIAL
  );

CREATE INDEX IX_PROD_CAT_SPECIAL ON PRODUCTS 
  (
  CATEGORY,
  SPECIAL
  );
  
CREATE INDEX IX_PROD_MEMBERSHIP ON PRODUCTS  
  (
  MEMBERSHIP_ITEM
  )
  ;

CREATE INDEX IX_INV_PROD_ID ON INVENTORY
  (
  PROD_ID
  ) 
  ;

ALTER TABLE MEMBERSHIP
  ADD CONSTRAINT FK_MEMBERSHIP_CUSTID FOREIGN KEY (CUSTOMERID)
  REFERENCES CUSTOMERS (CUSTOMERID)
  ON DELETE CASCADE
  ;

ALTER TABLE REVIEWS
  ADD CONSTRAINT FK_PROD_ID FOREIGN KEY (PROD_ID)
  REFERENCES PRODUCTS (PROD_ID)
  ON DELETE CASCADE
  ;

ALTER TABLE REVIEWS
  ADD CONSTRAINT FK_REVIEW_CUSTOMERID FOREIGN KEY (CUSTOMERID)
  REFERENCES CUSTOMERS (CUSTOMERID)
  ON DELETE CASCADE
  ;

CREATE INDEX IX_REVIEWS_PROD_ID ON REVIEWS
  (
  PROD_ID
  )
  ;

CREATE INDEX IX_REVIEWS_STARS ON REVIEWS
  (
  STARS
  )
  ;

CREATE INDEX IX_REVIEWS_PRODSTARS ON REVIEWS 
  (
  PROD_ID,STARS
  )
  ;

ALTER TABLE REVIEWS_HELPFULNESS
  ADD CONSTRAINT FK_REVIEW_ID FOREIGN KEY (REVIEW_ID)
    REFERENCES REVIEWS (REVIEW_ID)
	ON DELETE CASCADE
  ;

CREATE INDEX IX_REVIEWS_HELP_REVID ON REVIEWS_HELPFULNESS 
  (
  REVIEW_ID
  )
  ;

CREATE INDEX IX_REVIEWS_HELP_CUSTID ON REVIEWS_HELPFULNESS  
  (
  CUSTOMERID
  )
  ;

CREATE INDEX IX_REORDER_PRODID ON REORDER 
  (
  PROD_ID
  )
  ;
